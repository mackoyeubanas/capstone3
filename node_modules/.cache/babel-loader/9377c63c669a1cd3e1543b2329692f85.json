{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Microsoft\\\\Documents\\\\capstone3\\\\capstone3\\\\src\\\\components\\\\bookingComponents\\\\bookingDashboard.jsx\";\n\n/* Booking dashboard */\nimport React, { Component } from 'react';\nimport { Form, Col, Button, Row, Alert, Container } from 'react-bootstrap';\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\nimport CarServiceApi from '../../api/CarServiceApi';\nimport BookingServiceApi from '../../api/BookingServiceApi';\nimport LocationServiceApi from '../../api/LocationServiceApi';\n\nclass BookingDashboard extends Component {\n  constructor(_props) {\n    super(_props);\n\n    this.handleChange = event => {\n      this.setState({\n        [event.target.name]: event.target.value\n      });\n    };\n\n    this.handleSubmit = event => {\n      event.preventDefault(); // check for available cars and redirect\n\n      let newSearch = {\n        pickupTime: this.state.pickupTime,\n        returnTime: this.state.returnTime\n      }; // publish search all available cars request to backend\n\n      CarServiceApi.searchAvailableCars(newSearch).then(res => {\n        // passing available cars to filter car page\n        this.props.updateCars(res.data.availableCars, this.state.pickupTime, this.state.returnTime);\n        this.props.history.push('/filter');\n      }).catch(error => {\n        // display error if there's any\n        this.setState({\n          errorMessage: error.response.data.message\n        });\n      });\n    };\n\n    this.mapOnMarkerClick = (props, marker) => this.setState({\n      selectedPlace: props,\n      activeMarker: marker,\n      showingInfoWindow: true\n    });\n\n    this.mapOnMapClick = () => this.setState({\n      showingInfoWindow: false,\n      selectedPlace: {},\n      activeMarker: {}\n    });\n\n    this.state = {\n      pickupTime: '',\n      returnTime: '',\n      errorMessage: '',\n      nextBooking: {},\n      nextBookingExists: false,\n      car: '',\n      driver: '',\n      location: '',\n      successHeader: '',\n      successMsg: '',\n      availablePickup: false,\n      avaialbleReturn: false,\n      activeMarker: {},\n      showingInfoWindow: false,\n      selectedPlace: {},\n      isLoading: false\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.handlePickupButton = this.handlePickupButton.bind(this);\n    this.handleReturnButton = this.handleReturnButton.bind(this);\n  }\n\n  handlePickupButton() {\n    // change booking status to picked up\n    let nextBooking = this.state.nextBooking;\n    nextBooking.status = 'Picked up';\n    nextBooking.id = nextBooking._id;\n    this.setState({\n      nextBooking: nextBooking\n    }); // update booking object in database\n\n    BookingServiceApi.modifyBooking(this.state.nextBooking).then(() => {\n      this.setState({\n        successHeader: 'Pickup success!',\n        successMsg: \"Car has been picked up! Please return it before your specified return time.\",\n        availablePickup: false,\n        avaialbleReturn: true\n      });\n    });\n  }\n\n  handleReturnButton() {\n    // change booking status to returned\n    let nextBooking = this.state.nextBooking;\n    nextBooking.status = 'Returned';\n    nextBooking.id = nextBooking._id;\n    this.setState({\n      nextBooking: nextBooking\n    }); // update booking object in database\n\n    BookingServiceApi.modifyBooking(this.state.nextBooking).then(() => {\n      this.setState({\n        successHeader: 'Return success!',\n        successMsg: \"Car has been returned! Thanks for using MZA Car Share!\",\n        avaialbleReturn: false\n      });\n    });\n  }\n\n  componentDidMount() {\n    // obtain customer's upcoming booking  with required elements if any\n    BookingServiceApi.getNextBooking().then(res => {\n      if (Object.keys(res.data).length) {\n        // display upcoming booking and show pickup/return button when available\n        let currentTime = new Date();\n        currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\n        this.setState({\n          nextBooking: res.data,\n          nextBookingExists: true,\n          availablePickup: !(new Date(res.data.pickuptime) > currentTime) && res.data.status === \"Confirmed\",\n          avaialbleReturn: res.data.status === \"Picked up\"\n        });\n        CarServiceApi.getCar(res.data.car).then(res => {\n          this.setState({\n            car: res.data.car\n          });\n        });\n        LocationServiceApi.getLocationFromId(res.data.location).then(res => {\n          LocationServiceApi.getGeocodeFromAddress(res.data.address).then(newRes => {\n            // Create object with address, latitude and longitude\n            let locationObject = {\n              id: res.data._id,\n              address: res.data.address,\n              name: res.data.name,\n              lat: newRes.data.results[0].geometry.location.lat,\n              lng: newRes.data.results[0].geometry.location.lng,\n              cars: res.data.cars\n            }; // set new location object to react state array\n\n            this.setState({\n              location: locationObject,\n              isLoading: true\n            });\n          });\n        });\n      }\n    }).catch(error => {\n      this.setState({\n        errorMessage: error.response.data.message\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 13\n      }\n    }, this.state.successMsg && /*#__PURE__*/React.createElement(Alert, {\n      variant: \"success\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Alert.Heading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 25\n      }\n    }, this.state.successHeader), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 25\n      }\n    }, this.state.successMsg)), this.state.nextBookingExists && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"white-cards-div\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 29\n      }\n    }, \"Your upcoming booking: \"), this.state.isLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"garage-map\",\n      style: {\n        height: '400px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 54\n      }\n    }, /*#__PURE__*/React.createElement(Map, {\n      google: this.props.google,\n      initialCenter: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      style: {\n        height: '400px',\n        width: '400px'\n      },\n      zoom: 14,\n      onClick: this.mapOnMapClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(Marker, {\n      id: this.state.location.id,\n      name: this.state.location.name,\n      address: this.state.location.address,\n      onClick: this.mapOnMarkerClick,\n      position: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(InfoWindow, {\n      onClose: this.onInfoWindowClose,\n      marker: this.state.activeMarker,\n      visible: this.state.showingInfoWindow,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"info-window\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 41\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 45\n      }\n    }, this.state.selectedPlace.name), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 45\n      }\n    }, this.state.selectedPlace.address), /*#__PURE__*/React.createElement(\"a\", {\n      href: \"/locations/\" + this.state.selectedPlace.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 45\n      }\n    }, \"Check out this location\"))))), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 29\n      }\n    }, \"Booking ID: \"), \" \", this.state.nextBooking._id, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 78\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 29\n      }\n    }, \"Booking time: \"), \" \", this.state.nextBooking.bookedtime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 87\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 29\n      }\n    }, \"Pickup time: \"), \" \", this.state.nextBooking.pickuptime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 86\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 29\n      }\n    }, \"Return time: \"), \" \", this.state.nextBooking.returntime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 86\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 29\n      }\n    }, \"Cost: \"), \" Php\", this.state.nextBooking.cost, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 76\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 29\n      }\n    }, \"Location: \"), \" \", this.state.location.name, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 74\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 29\n      }\n    }, \"Address: \"), \" \", this.state.location.address, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 76\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 29\n      }\n    }, \"Status: \"), \" \", this.state.nextBooking.status, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 77\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      variant: \"success\",\n      onClick: this.handlePickupButton,\n      disabled: !this.state.availablePickup,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 29\n      }\n    }, \"Pickup\"), /*#__PURE__*/React.createElement(Button, {\n      variant: \"danger\",\n      onClick: this.handleReturnButton,\n      disabled: !this.state.avaialbleReturn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 29\n      }\n    }, \"Return\"), /*#__PURE__*/React.createElement(Button, {\n      href: `/mybookings/${this.state.nextBooking._id}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 29\n      }\n    }, \"View Booking\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cars-div-white\",\n      style: {\n        'border': 'solid black 2px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.car.image,\n      alt: \"car\",\n      width: \"100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"h2\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 37\n      }\n    }, this.state.car.make), /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 37\n      }\n    }, this.state.car.driver), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 37\n      }\n    }, this.state.car.fueltype, \", \", this.state.car.bodytype, \", \", this.state.car.seats, \" seaters, \", this.state.car.colour), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 37\n      }\n    }, \"Number Plate: \", this.state.car.numberplate), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 40\n      }\n    }, \"Car ID: \"), this.state.car._id))))), /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }\n    }, \"Let's find you a car!\"), this.state.errorMessage && /*#__PURE__*/React.createElement(Alert, {\n      variant: \"danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 45\n      }\n    }, /*#__PURE__*/React.createElement(Alert.Heading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 21\n      }\n    }, \"Error checking availability!\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 21\n      }\n    }, this.state.errorMessage)), /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.handleSubmit,\n      id: \"availability_form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      as: Row,\n      controlId: \"formHorizontalFirstName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Form.Label, {\n      column: true,\n      sm: 2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 25\n      }\n    }, \"Pickup Time\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 10,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      name: \"pickupTime\",\n      type: \"datetime-local\",\n      onChange: this.handleChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 29\n      }\n    }))), /*#__PURE__*/React.createElement(Form.Group, {\n      as: Row,\n      controlId: \"formHorizontalLastName\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Form.Label, {\n      column: true,\n      sm: 2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 25\n      }\n    }, \"Return Time\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 10,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      name: \"returnTime\",\n      type: \"datetime-local\",\n      onChange: this.handleChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 29\n      }\n    }))), /*#__PURE__*/React.createElement(Form.Group, {\n      as: Row,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      sm: {\n        span: 10,\n        offset: 2\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 29\n      }\n    }, \"Check Availability\")))));\n  }\n\n}\n\nexport default GoogleApiWrapper({\n  apiKey: process.env.REACT_APP_API_KEY\n})(BookingDashboard);","map":{"version":3,"sources":["C:/Users/Microsoft/Documents/capstone3/capstone3/src/components/bookingComponents/bookingDashboard.jsx"],"names":["React","Component","Form","Col","Button","Row","Alert","Container","Map","InfoWindow","Marker","GoogleApiWrapper","CarServiceApi","BookingServiceApi","LocationServiceApi","BookingDashboard","constructor","props","handleChange","event","setState","target","name","value","handleSubmit","preventDefault","newSearch","pickupTime","state","returnTime","searchAvailableCars","then","res","updateCars","data","availableCars","history","push","catch","error","errorMessage","response","message","mapOnMarkerClick","marker","selectedPlace","activeMarker","showingInfoWindow","mapOnMapClick","nextBooking","nextBookingExists","car","driver","location","successHeader","successMsg","availablePickup","avaialbleReturn","isLoading","bind","handlePickupButton","handleReturnButton","status","id","_id","modifyBooking","componentDidMount","getNextBooking","Object","keys","length","currentTime","Date","setMinutes","getMinutes","getTimezoneOffset","pickuptime","getCar","getLocationFromId","getGeocodeFromAddress","address","newRes","locationObject","lat","results","geometry","lng","cars","render","height","google","width","onInfoWindowClose","bookedtime","returntime","cost","image","marginTop","make","fueltype","bodytype","seats","colour","numberplate","span","offset","apiKey","process","env","REACT_APP_API_KEY"],"mappings":"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","sourcesContent":["/* Booking dashboard */\r\nimport React, { Component } from 'react';\r\nimport { Form, Col, Button, Row, Alert, Container } from 'react-bootstrap';\r\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\r\nimport CarServiceApi from '../../api/CarServiceApi';\r\nimport BookingServiceApi from '../../api/BookingServiceApi';\r\nimport LocationServiceApi from '../../api/LocationServiceApi';\r\n\r\nclass BookingDashboard extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            pickupTime: '',\r\n            returnTime: '',\r\n            errorMessage: '',\r\n            nextBooking: {},\r\n            nextBookingExists: false,\r\n            car: '',\r\n            driver: '',\r\n            location: '',\r\n            successHeader: '',\r\n            successMsg: '',\r\n            availablePickup: false,\r\n            avaialbleReturn: false,\r\n            activeMarker: {},\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            isLoading: false\r\n        };\r\n        this.handleSubmit = this.handleSubmit.bind(this);\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.handlePickupButton = this.handlePickupButton.bind(this);\r\n        this.handleReturnButton = this.handleReturnButton.bind(this);\r\n    }\r\n\r\n    handleChange = event => {\r\n        this.setState({ [event.target.name]: event.target.value });\r\n    };\r\n\r\n    handleSubmit = event => {\r\n        event.preventDefault();\r\n        // check for available cars and redirect\r\n        let newSearch = {\r\n            pickupTime: this.state.pickupTime,\r\n            returnTime: this.state.returnTime\r\n        };\r\n        // publish search all available cars request to backend\r\n        CarServiceApi.searchAvailableCars(newSearch).then(res => {\r\n            // passing available cars to filter car page\r\n            this.props.updateCars(res.data.availableCars, this.state.pickupTime, this.state.returnTime);\r\n            this.props.history.push('/filter');\r\n        }).catch((error) => {\r\n            // display error if there's any\r\n            this.setState({ errorMessage: error.response.data.message });\r\n        });\r\n    };\r\n\r\n    handlePickupButton() {\r\n        // change booking status to picked up\r\n        let nextBooking = this.state.nextBooking;\r\n        nextBooking.status = 'Picked up';\r\n        nextBooking.id = nextBooking._id;\r\n        this.setState({\r\n            nextBooking: nextBooking\r\n        });\r\n        // update booking object in database\r\n        BookingServiceApi.modifyBooking(this.state.nextBooking)\r\n            .then(() => {\r\n                this.setState({\r\n                    successHeader: 'Pickup success!',\r\n                    successMsg: \"Car has been picked up! Please return it before your specified return time.\",\r\n                    availablePickup: false,\r\n                    avaialbleReturn: true\r\n                });\r\n            });\r\n    }\r\n\r\n    mapOnMarkerClick = (props, marker) =>\r\n        this.setState({\r\n            selectedPlace: props,\r\n            activeMarker: marker,\r\n            showingInfoWindow: true,\r\n        });\r\n\r\n    mapOnMapClick = () =>\r\n        this.setState({\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            activeMarker: {}\r\n        });\r\n\r\n    handleReturnButton() {\r\n        // change booking status to returned\r\n        let nextBooking = this.state.nextBooking;\r\n        nextBooking.status = 'Returned';\r\n        nextBooking.id = nextBooking._id;\r\n        this.setState({\r\n            nextBooking: nextBooking\r\n        });\r\n        // update booking object in database\r\n        BookingServiceApi.modifyBooking(this.state.nextBooking)\r\n            .then(() => {\r\n                this.setState({\r\n                    successHeader: 'Return success!',\r\n                    successMsg: \"Car has been returned! Thanks for using MZA Car Share!\",\r\n                    avaialbleReturn: false\r\n                })\r\n            })\r\n    }\r\n\r\n    componentDidMount() {\r\n        // obtain customer's upcoming booking  with required elements if any\r\n        BookingServiceApi.getNextBooking().then(res => {\r\n            if (Object.keys(res.data).length) {\r\n                // display upcoming booking and show pickup/return button when available\r\n                let currentTime = new Date();\r\n                currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\r\n                this.setState({\r\n                    nextBooking: res.data,\r\n                    nextBookingExists: true,\r\n                    availablePickup: (!(new Date(res.data.pickuptime) > currentTime) && res.data.status === \"Confirmed\"),\r\n                    avaialbleReturn: res.data.status === \"Picked up\"\r\n                });\r\n                CarServiceApi.getCar(res.data.car)\r\n                    .then(res => {\r\n                        this.setState({\r\n                            car: res.data.car\r\n                        });\r\n                    });\r\n                LocationServiceApi.getLocationFromId(res.data.location)\r\n                    .then(res => {\r\n                        LocationServiceApi.getGeocodeFromAddress(res.data.address)\r\n                            .then(newRes => {\r\n                                // Create object with address, latitude and longitude\r\n                                let locationObject = {\r\n                                    id: res.data._id,\r\n                                    address: res.data.address,\r\n                                    name: res.data.name,\r\n                                    lat: newRes.data.results[0].geometry.location.lat,\r\n                                    lng: newRes.data.results[0].geometry.location.lng,\r\n                                    cars: res.data.cars\r\n                                };\r\n                                // set new location object to react state array\r\n                                this.setState({\r\n                                    location: locationObject,\r\n                                    isLoading: true\r\n                                });\r\n                            });\r\n                    });\r\n            }\r\n        }).catch((error) => {\r\n            this.setState({ errorMessage: error.response.data.message });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Container>\r\n                {this.state.successMsg &&\r\n                    <Alert variant=\"success\">\r\n                        <Alert.Heading>{this.state.successHeader}</Alert.Heading>\r\n                        <p>\r\n                            {this.state.successMsg}\r\n                        </p>\r\n                    </Alert>\r\n                }\r\n                {this.state.nextBookingExists &&\r\n                    <div className=\"white-cards-div\">\r\n                        <Container>\r\n                            <h2>Your upcoming booking: </h2>\r\n                            {this.state.isLoading && <div id=\"garage-map\" style={{ height: '400px' }}>\r\n                                <Map google={this.props.google}\r\n                                    initialCenter={{\r\n                                        lat: this.state.location.lat,\r\n                                        lng: this.state.location.lng\r\n                                    }}\r\n                                    style={{ height: '400px', width: '400px' }}\r\n                                    zoom={14}\r\n                                    onClick={this.mapOnMapClick}>\r\n\r\n                                    <Marker\r\n                                        id={this.state.location.id}\r\n                                        name={this.state.location.name}\r\n                                        address={this.state.location.address}\r\n                                        onClick={this.mapOnMarkerClick}\r\n                                        position={{ lat: this.state.location.lat, lng: this.state.location.lng }}\r\n                                    />\r\n\r\n                                    <InfoWindow\r\n                                        onClose={this.onInfoWindowClose}\r\n                                        marker={this.state.activeMarker}\r\n                                        visible={this.state.showingInfoWindow}>\r\n                                        <div id=\"info-window\">\r\n                                            <h2>{this.state.selectedPlace.name}</h2>\r\n                                            <p>{this.state.selectedPlace.address}</p>\r\n                                            <a href={\"/locations/\" + this.state.selectedPlace.id}>Check out this location</a>\r\n                                        </div>\r\n                                    </InfoWindow>\r\n                                </Map>\r\n                            </div>}\r\n                            <b>Booking ID: </b> {this.state.nextBooking._id} <br></br>\r\n                            <b>Booking time: </b> {this.state.nextBooking.bookedtime} <br></br>\r\n                            <b>Pickup time: </b> {this.state.nextBooking.pickuptime} <br></br>\r\n                            <b>Return time: </b> {this.state.nextBooking.returntime} <br></br>\r\n                            <b>Cost: </b> Php{this.state.nextBooking.cost} <br></br>\r\n                            <b>Location: </b> {this.state.location.name} <br></br>\r\n                            <b>Address: </b> {this.state.location.address} <br></br>\r\n                            <b>Status: </b> {this.state.nextBooking.status} <br></br>\r\n                            <Button variant=\"success\" onClick={this.handlePickupButton} disabled={!this.state.availablePickup}>Pickup</Button>\r\n                            <Button variant=\"danger\" onClick={this.handleReturnButton} disabled={!this.state.avaialbleReturn}>Return</Button>\r\n                            <Button href={`/mybookings/${this.state.nextBooking._id}`}>View Booking</Button>\r\n                            <Col sm={4}>\r\n                                <div className=\"cars-div-white\" style={{ 'border': 'solid black 2px' }}>\r\n                                    <img src={this.state.car.image} alt=\"car\" width=\"100\" />\r\n                                    <h2 style={{ marginTop: '1vh' }}>{this.state.car.make}</h2>\r\n                                    <h3 style={{ marginTop: '1vh' }}>{this.state.car.driver}</h3>\r\n                                    <p>{this.state.car.fueltype}, {this.state.car.bodytype}, {this.state.car.seats} seaters, {this.state.car.colour}</p>\r\n                                    <h5>Number Plate: {this.state.car.numberplate}</h5>\r\n                                    <p><b>Car ID: </b>{this.state.car._id}</p>\r\n                                </div>\r\n                            </Col>\r\n                        </Container>\r\n                    </div>\r\n                }\r\n                <h2>Let's find you a car!</h2>\r\n                {this.state.errorMessage && <Alert variant=\"danger\">\r\n                    <Alert.Heading>Error checking availability!</Alert.Heading>\r\n                    <p>\r\n                        {this.state.errorMessage}\r\n                    </p>\r\n                </Alert>}\r\n                <Form onSubmit={this.handleSubmit} id=\"availability_form\" >\r\n                    <Form.Group as={Row} controlId=\"formHorizontalFirstName\">\r\n                        <Form.Label column sm={2}>\r\n                            Pickup Time\r\n                        </Form.Label>\r\n                        <Col sm={10}>\r\n                            <Form.Control name=\"pickupTime\" type=\"datetime-local\" onChange={this.handleChange} required />\r\n                        </Col>\r\n                    </Form.Group>\r\n\r\n                    <Form.Group as={Row} controlId=\"formHorizontalLastName\">\r\n                        <Form.Label column sm={2}>\r\n                            Return Time\r\n                        </Form.Label>\r\n                        <Col sm={10}>\r\n                            <Form.Control name=\"returnTime\" type=\"datetime-local\" onChange={this.handleChange} required />\r\n                        </Col>\r\n                    </Form.Group>\r\n\r\n                    <Form.Group as={Row}>\r\n                        <Col sm={{ span: 10, offset: 2 }}>\r\n                            <Button type=\"submit\">Check Availability</Button>\r\n                        </Col>\r\n                    </Form.Group>\r\n                </Form>\r\n            </Container>\r\n        )\r\n    }\r\n}\r\n\r\nexport default GoogleApiWrapper({\r\n    apiKey: process.env.REACT_APP_API_KEY\r\n})(BookingDashboard);\r\n"]},"metadata":{},"sourceType":"module"}