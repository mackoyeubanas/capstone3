{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Microsoft\\\\Documents\\\\capstone3\\\\capstone3\\\\src\\\\components\\\\staffComponents\\\\viewBooking.jsx\";\n\n/* View booking page */\nimport React, { Component } from 'react';\nimport { Alert, Button, Container, Col } from 'react-bootstrap';\nimport BookingServiceApi from '../../api/BookingServiceApi';\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\n\nconst {\n  default: LocationServiceApi\n} = require(\"../../api/LocationServiceApi\");\n\nconst {\n  default: CarServiceApi\n} = require(\"../../api/CarServiceApi\");\n\nclass ViewBookingPage extends Component {\n  constructor(_props) {\n    super(_props);\n\n    this.mapOnMarkerClick = (props, marker) => this.setState({\n      selectedPlace: props,\n      activeMarker: marker,\n      showingInfoWindow: true\n    });\n\n    this.mapOnMapClick = () => this.setState({\n      showingInfoWindow: false,\n      selectedPlace: {},\n      activeMarker: {}\n    });\n\n    this.state = {\n      booking: {},\n      car: {},\n      location: {},\n      errorMessage: '',\n      activeMarker: {},\n      showingInfoWindow: false,\n      selectedPlace: {},\n      isLoading: false\n    };\n    this.handleCancelButton = this.handleCancelButton.bind(this);\n  }\n\n  getBookingDetails() {\n    // get booking details by id, also fetch required elements\n    BookingServiceApi.getBooking(this.props.match.params.id).then(res => {\n      this.setState({\n        booking: res.data.booking\n      });\n      CarServiceApi.getCar(this.state.booking.car).then(res => {\n        this.setState({\n          car: res.data.car\n        });\n      });\n      LocationServiceApi.getLocationFromId(this.state.booking.location).then(res => {\n        LocationServiceApi.getGeocodeFromAddress(res.data.address).then(newRes => {\n          // Create object with address, latitude and longitude\n          let locationObject = {\n            id: res.data._id,\n            address: res.data.address,\n            name: res.data.name,\n            lat: newRes.data.results[0].geometry.location.lat,\n            lng: newRes.data.results[0].geometry.location.lng,\n            cars: res.data.cars\n          }; // set new location object to react state array\n\n          this.setState({\n            location: locationObject,\n            isLoading: true\n          });\n        });\n      });\n    }).catch(error => {\n      this.setState({\n        errorMessage: error.response.data.message\n      });\n    });\n  }\n\n  componentDidMount() {\n    this.getBookingDetails();\n  }\n\n  handleCancelButton() {\n    // change booking status to cancelled\n    let booking = this.state.booking;\n    booking.status = 'Cancelled';\n    booking.id = booking._id;\n    this.setState({\n      booking: booking\n    }); // update booking object in backend\n\n    BookingServiceApi.modifyBooking(this.state.booking).then(() => {\n      this.getBookingDetails();\n    });\n  }\n\n  checkBookingPast(pickupTime) {\n    // check if booking pickup time has past current time\n    let currentTime = new Date();\n    currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\n    return new Date(pickupTime) > currentTime;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }\n    }, \"Booking details\"), this.state.errorMessage && /*#__PURE__*/React.createElement(Alert, {\n      variant: \"danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 45\n      }\n    }, /*#__PURE__*/React.createElement(Alert.Heading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 21\n      }\n    }, \"Error obtaining booking!\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 21\n      }\n    }, this.state.errorMessage)), this.state.isLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"garage-map\",\n      style: {\n        height: '400px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 42\n      }\n    }, /*#__PURE__*/React.createElement(Map, {\n      google: this.props.google,\n      initialCenter: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      style: {\n        height: '400px',\n        width: '400px'\n      },\n      zoom: 14,\n      onClick: this.mapOnMapClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Marker, {\n      id: this.state.location.id,\n      name: this.state.location.name,\n      address: this.state.location.address,\n      onClick: this.mapOnMarkerClick,\n      position: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(InfoWindow, {\n      onClose: this.onInfoWindowClose,\n      marker: this.state.activeMarker,\n      visible: this.state.showingInfoWindow,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"info-window\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 33\n      }\n    }, this.state.selectedPlace.name), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 33\n      }\n    }, this.state.selectedPlace.address), /*#__PURE__*/React.createElement(\"a\", {\n      href: \"/locations/\" + this.state.selectedPlace.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 33\n      }\n    }, \"Check out this location\"))))), !this.state.errorMessage && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 25\n      }\n    }, \"Booking ID: \"), \" \", this.state.booking._id, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 70\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 25\n      }\n    }, \"Booking time: \"), \" \", this.state.booking.bookedtime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 79\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 25\n      }\n    }, \"Pickup time: \"), \" \", this.state.booking.pickuptime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 78\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 25\n      }\n    }, \"Return time: \"), \" \", this.state.booking.returntime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 78\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 25\n      }\n    }, \"Cost: \"), \" $\", this.state.booking.cost, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 66\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 25\n      }\n    }, \"Location: \"), \" \", /*#__PURE__*/React.createElement(\"a\", {\n      href: `/admin/view/location/${this.state.location.id}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 43\n      }\n    }, this.state.location.name), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 133\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 25\n      }\n    }, \"Address: \"), \" \", this.state.location.address, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 72\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 25\n      }\n    }, \"Status: \"), \" \", this.state.booking.status, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 69\n      }\n    }), this.state.booking.status === \"Confirmed\" && this.checkBookingPast(this.state.booking.pickuptime) && /*#__PURE__*/React.createElement(Button, {\n      variant: \"danger\",\n      onClick: this.handleCancelButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 29\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cars-div-white\",\n      style: {\n        'border': 'solid black 2px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.car.image,\n      alt: \"car\",\n      width: \"100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 33\n      }\n    }), /*#__PURE__*/React.createElement(\"h2\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 33\n      }\n    }, this.state.car.make), /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 33\n      }\n    }, this.state.car.driver), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 33\n      }\n    }, this.state.car.fueltype, \", \", this.state.car.bodytype, \", \", this.state.car.seats, \" seaters, \", this.state.car.colour), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 33\n      }\n    }, \"Php\", this.state.car.costperhour, \" per hour\"), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 33\n      }\n    }, \"Number Plate: \", this.state.car.numberplate), /*#__PURE__*/React.createElement(\"a\", {\n      href: `/admin/view/cars/${this.state.car._id}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 84\n      }\n    }, \"Car ID: \"), this.state.car._id)))));\n  }\n\n}\n\nexport default GoogleApiWrapper({\n  apiKey: process.env.REACT_APP_API_KEY\n})(ViewBookingPage);","map":{"version":3,"sources":["C:/Users/Microsoft/Documents/capstone3/capstone3/src/components/staffComponents/viewBooking.jsx"],"names":["React","Component","Alert","Button","Container","Col","BookingServiceApi","Map","InfoWindow","Marker","GoogleApiWrapper","default","LocationServiceApi","require","CarServiceApi","ViewBookingPage","constructor","props","mapOnMarkerClick","marker","setState","selectedPlace","activeMarker","showingInfoWindow","mapOnMapClick","state","booking","car","location","errorMessage","isLoading","handleCancelButton","bind","getBookingDetails","getBooking","match","params","id","then","res","data","getCar","getLocationFromId","getGeocodeFromAddress","address","newRes","locationObject","_id","name","lat","results","geometry","lng","cars","catch","error","response","message","componentDidMount","status","modifyBooking","checkBookingPast","pickupTime","currentTime","Date","setMinutes","getMinutes","getTimezoneOffset","render","height","google","width","onInfoWindowClose","bookedtime","pickuptime","returntime","cost","image","marginTop","make","driver","fueltype","bodytype","seats","colour","costperhour","numberplate","apiKey","process","env","REACT_APP_API_KEY"],"mappings":"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","sourcesContent":["/* View booking page */\r\nimport React, { Component } from 'react';\r\nimport { Alert, Button, Container, Col } from 'react-bootstrap';\r\nimport BookingServiceApi from '../../api/BookingServiceApi';\r\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\r\nconst { default: LocationServiceApi } = require(\"../../api/LocationServiceApi\");\r\nconst { default: CarServiceApi } = require(\"../../api/CarServiceApi\");\r\n\r\nclass ViewBookingPage extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            booking: {},\r\n            car: {},\r\n            location: {},\r\n            errorMessage: '',\r\n            activeMarker: {},\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            isLoading: false\r\n        };\r\n        this.handleCancelButton = this.handleCancelButton.bind(this);\r\n    }\r\n\r\n    getBookingDetails() {\r\n        // get booking details by id, also fetch required elements\r\n        BookingServiceApi.getBooking(this.props.match.params.id)\r\n            .then(res => {\r\n                this.setState({\r\n                    booking: res.data.booking\r\n                });\r\n                CarServiceApi.getCar(this.state.booking.car)\r\n                    .then(res => {\r\n                        this.setState({\r\n                            car: res.data.car\r\n                        });\r\n                    });\r\n                LocationServiceApi.getLocationFromId(this.state.booking.location)\r\n                    .then(res => {\r\n                        LocationServiceApi.getGeocodeFromAddress(res.data.address)\r\n                            .then(newRes => {\r\n                                // Create object with address, latitude and longitude\r\n                                let locationObject = {\r\n                                    id: res.data._id,\r\n                                    address: res.data.address,\r\n                                    name: res.data.name,\r\n                                    lat: newRes.data.results[0].geometry.location.lat,\r\n                                    lng: newRes.data.results[0].geometry.location.lng,\r\n                                    cars: res.data.cars\r\n                                };\r\n                                // set new location object to react state array\r\n                                this.setState({\r\n                                    location: locationObject,\r\n                                    isLoading: true\r\n                                });\r\n                            });\r\n                    });\r\n            }).catch((error) => {\r\n                this.setState({ errorMessage: error.response.data.message });\r\n            });\r\n    }\r\n\r\n    mapOnMarkerClick = (props, marker) =>\r\n        this.setState({\r\n            selectedPlace: props,\r\n            activeMarker: marker,\r\n            showingInfoWindow: true,\r\n        });\r\n\r\n    mapOnMapClick = () =>\r\n        this.setState({\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            activeMarker: {}\r\n        });\r\n\r\n    componentDidMount() {\r\n        this.getBookingDetails();\r\n    }\r\n\r\n    handleCancelButton() {\r\n        // change booking status to cancelled\r\n        let booking = this.state.booking;\r\n        booking.status = 'Cancelled';\r\n        booking.id = booking._id;\r\n        this.setState({\r\n            booking: booking\r\n        });\r\n        // update booking object in backend\r\n        BookingServiceApi.modifyBooking(this.state.booking)\r\n            .then(() => {\r\n                this.getBookingDetails();\r\n            });\r\n    }\r\n\r\n    checkBookingPast(pickupTime) {\r\n        // check if booking pickup time has past current time\r\n        let currentTime = new Date();\r\n        currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\r\n        return new Date(pickupTime) > currentTime;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Container>\r\n                <h2>Booking details</h2>\r\n                {this.state.errorMessage && <Alert variant=\"danger\">\r\n                    <Alert.Heading>Error obtaining booking!</Alert.Heading>\r\n                    <p>\r\n                        {this.state.errorMessage}\r\n                    </p>\r\n                </Alert>}\r\n                {this.state.isLoading && <div id=\"garage-map\" style={{ height: '400px' }}>\r\n                    <Map google={this.props.google}\r\n                        initialCenter={{\r\n                            lat: this.state.location.lat,\r\n                            lng: this.state.location.lng\r\n                        }}\r\n                        style={{ height: '400px', width: '400px' }}\r\n                        zoom={14}\r\n                        onClick={this.mapOnMapClick}>\r\n\r\n                        <Marker\r\n                            id={this.state.location.id}\r\n                            name={this.state.location.name}\r\n                            address={this.state.location.address}\r\n                            onClick={this.mapOnMarkerClick}\r\n                            position={{ lat: this.state.location.lat, lng: this.state.location.lng }}\r\n                        />\r\n\r\n                        <InfoWindow\r\n                            onClose={this.onInfoWindowClose}\r\n                            marker={this.state.activeMarker}\r\n                            visible={this.state.showingInfoWindow}>\r\n                            <div id=\"info-window\">\r\n                                <h2>{this.state.selectedPlace.name}</h2>\r\n                                <p>{this.state.selectedPlace.address}</p>\r\n                                <a href={\"/locations/\" + this.state.selectedPlace.id}>Check out this location</a>\r\n                            </div>\r\n                        </InfoWindow>\r\n                    </Map>\r\n                </div>}\r\n                {!this.state.errorMessage &&\r\n                    <>\r\n                        <b>Booking ID: </b> {this.state.booking._id} <br></br>\r\n                        <b>Booking time: </b> {this.state.booking.bookedtime} <br></br>\r\n                        <b>Pickup time: </b> {this.state.booking.pickuptime} <br></br>\r\n                        <b>Return time: </b> {this.state.booking.returntime} <br></br>\r\n                        <b>Cost: </b> ${this.state.booking.cost} <br></br>\r\n                        <b>Location: </b> <a href={`/admin/view/location/${this.state.location.id}`}>{this.state.location.name}</a> <br></br>\r\n                        <b>Address: </b> {this.state.location.address} <br></br>\r\n                        <b>Status: </b> {this.state.booking.status} <br></br>\r\n                        {(this.state.booking.status === \"Confirmed\" && this.checkBookingPast(this.state.booking.pickuptime)) &&\r\n                            <Button variant=\"danger\" onClick={this.handleCancelButton}>Cancel</Button>\r\n                        }\r\n                        <Col sm={4}>\r\n                            <div className=\"cars-div-white\" style={{ 'border': 'solid black 2px' }}>\r\n                                <img src={this.state.car.image} alt=\"car\" width=\"100\" />\r\n                                <h2 style={{ marginTop: '1vh' }}>{this.state.car.make}</h2>\r\n                                <h3 style={{ marginTop: '1vh' }}>{this.state.car.driver}</h3>\r\n                                <p>{this.state.car.fueltype}, {this.state.car.bodytype}, {this.state.car.seats} seaters, {this.state.car.colour}</p>\r\n                                <h5>Php{this.state.car.costperhour} per hour</h5>\r\n                                <h5>Number Plate: {this.state.car.numberplate}</h5>\r\n                                <a href={`/admin/view/cars/${this.state.car._id}`}><b>Car ID: </b>{this.state.car._id}</a>\r\n                            </div>\r\n                        </Col>\r\n                    </>\r\n                }\r\n            </Container>\r\n        )\r\n    }\r\n}\r\n\r\nexport default GoogleApiWrapper({\r\n    apiKey: process.env.REACT_APP_API_KEY\r\n})(ViewBookingPage);\r\n"]},"metadata":{},"sourceType":"module"}