{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Microsoft\\\\Documents\\\\capstone3\\\\capstone3\\\\src\\\\components\\\\bookingComponents\\\\bookingDetails.jsx\";\n\n/* Bookings details page */\nimport React, { Component } from 'react';\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\nimport { Alert, Button, Col } from 'react-bootstrap';\nimport BookingServiceApi from '../../api/BookingServiceApi';\nimport CarServiceApi from '../../api/CarServiceApi';\nimport LocationServiceApi from '../../api/LocationServiceApi';\n\nclass BookingDetailsPage extends Component {\n  constructor(_props) {\n    super(_props);\n\n    this.mapOnMarkerClick = (props, marker) => this.setState({\n      selectedPlace: props,\n      activeMarker: marker,\n      showingInfoWindow: true\n    });\n\n    this.mapOnMapClick = () => this.setState({\n      showingInfoWindow: false,\n      selectedPlace: {},\n      activeMarker: {}\n    });\n\n    this.state = {\n      location: {},\n      booking: {},\n      driver: {},\n      car: {},\n      errorMessage: '',\n      activeMarker: {},\n      showingInfoWindow: false,\n      selectedPlace: {},\n      isLoading: false\n    };\n    this.handleCancelButton = this.handleCancelButton.bind(this);\n    this.getBookingDetails = this.getBookingDetails.bind(this);\n    this.checkBookingPast = this.checkBookingPast.bind(this);\n  }\n\n  getBookingDetails() {\n    // obtain a user's booking by booking id and also car and location associated\n    BookingServiceApi.getUserBooking(this.props.match.params.id).then(res => {\n      this.setState({\n        booking: res.data.booking\n      });\n      CarServiceApi.getCar(this.state.booking.car).then(res => {\n        this.setState({\n          car: res.data.car\n        });\n      });\n      LocationServiceApi.getLocationFromId(this.state.booking.location).then(res => {\n        LocationServiceApi.getGeocodeFromAddress(res.data.address).then(newRes => {\n          // Create object with address, latitude and longitude\n          let locationObject = {\n            id: res.data._id,\n            address: res.data.address,\n            name: res.data.name,\n            lat: newRes.data.results[0].geometry.location.lat,\n            lng: newRes.data.results[0].geometry.location.lng,\n            cars: res.data.cars\n          }; // set new location object to react state array\n\n          this.setState({\n            location: locationObject,\n            isLoading: true\n          });\n        });\n      });\n    }).catch(error => {\n      this.setState({\n        errorMessage: error.response.data.message\n      });\n    });\n  }\n\n  componentDidMount() {\n    this.getBookingDetails();\n  }\n\n  handleCancelButton() {\n    // modify booking status to cancelled\n    let booking = this.state.booking;\n    booking.status = 'Cancelled';\n    booking.id = booking._id;\n    this.setState({\n      booking: booking\n    });\n    BookingServiceApi.modifyBooking(this.state.booking).then(() => {\n      this.getBookingDetails();\n    }).catch(error => {\n      this.setState({\n        errorMessage: error.response.data.message\n      });\n    });\n  }\n\n  checkBookingPast(pickupTime) {\n    // check if booking pickup time has past current time\n    let currentTime = new Date();\n    currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\n    return new Date(pickupTime) > currentTime;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 17\n      }\n    }, \"Booking details\"), this.state.errorMessage && /*#__PURE__*/React.createElement(Alert, {\n      variant: \"danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 45\n      }\n    }, /*#__PURE__*/React.createElement(Alert.Heading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 21\n      }\n    }, \"Error obtaining booking!\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 21\n      }\n    }, this.state.errorMessage)), !this.state.errorMessage && /*#__PURE__*/React.createElement(React.Fragment, null, this.state.isLoading && /*#__PURE__*/React.createElement(\"div\", {\n      id: \"garage-map\",\n      style: {\n        height: '400px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 50\n      }\n    }, /*#__PURE__*/React.createElement(Map, {\n      google: this.props.google,\n      initialCenter: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      style: {\n        height: '400px',\n        width: '400px'\n      },\n      zoom: 14,\n      onClick: this.mapOnMapClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Marker, {\n      id: this.state.location.id,\n      name: this.state.location.name,\n      address: this.state.location.address,\n      onClick: this.mapOnMarkerClick,\n      position: {\n        lat: this.state.location.lat,\n        lng: this.state.location.lng\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 33\n      }\n    }), /*#__PURE__*/React.createElement(InfoWindow, {\n      onClose: this.onInfoWindowClose,\n      marker: this.state.activeMarker,\n      visible: this.state.showingInfoWindow,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"info-window\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 41\n      }\n    }, this.state.selectedPlace.name), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 41\n      }\n    }, this.state.selectedPlace.address), /*#__PURE__*/React.createElement(\"a\", {\n      href: \"/locations/\" + this.state.selectedPlace.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 41\n      }\n    }, \"Check out this location\"))))), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 25\n      }\n    }, \"Booking ID: \"), \" \", this.state.booking._id, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 70\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 25\n      }\n    }, \"Booking time: \"), \" \", this.state.booking.bookedtime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 79\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 25\n      }\n    }, \"Pickup time: \"), \" \", this.state.booking.pickuptime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 78\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 25\n      }\n    }, \"Return time: \"), \" \", this.state.booking.returntime, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 78\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 25\n      }\n    }, \"Cost: \"), \" Php\", this.state.booking.cost, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 68\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 25\n      }\n    }, \"Location: \"), \" \", this.state.location.name, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 70\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 25\n      }\n    }, \"Address: \"), \" \", this.state.location.address, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 72\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 25\n      }\n    }, \"Status: \"), \" \", this.state.booking.status, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 69\n      }\n    }), this.state.booking.status === \"Confirmed\" && this.checkBookingPast(this.state.booking.pickuptime) && /*#__PURE__*/React.createElement(Button, {\n      variant: \"danger\",\n      onClick: this.handleCancelButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 29\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cars-div-white\",\n      style: {\n        'border': 'solid black 2px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: this.state.car.image,\n      alt: \"car\",\n      width: \"100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 33\n      }\n    }), /*#__PURE__*/React.createElement(\"h2\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 33\n      }\n    }, this.state.car.make), /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        marginTop: '1vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 33\n      }\n    }, this.state.car.driver), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 33\n      }\n    }, this.state.car.fueltype, \", \", this.state.car.bodytype, \", \", this.state.car.seats, \" seaters, \", this.state.car.colour), /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 33\n      }\n    }, \"Number Plate: \", this.state.car.numberplate), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 36\n      }\n    }, \"Car ID: \"), this.state.car._id)))));\n  }\n\n}\n\nexport default GoogleApiWrapper({\n  apiKey: process.env.REACT_APP_API_KEY\n})(BookingDetailsPage);","map":{"version":3,"sources":["C:/Users/Microsoft/Documents/capstone3/capstone3/src/components/bookingComponents/bookingDetails.jsx"],"names":["React","Component","Map","InfoWindow","Marker","GoogleApiWrapper","Alert","Button","Col","BookingServiceApi","CarServiceApi","LocationServiceApi","BookingDetailsPage","constructor","props","mapOnMarkerClick","marker","setState","selectedPlace","activeMarker","showingInfoWindow","mapOnMapClick","state","location","booking","driver","car","errorMessage","isLoading","handleCancelButton","bind","getBookingDetails","checkBookingPast","getUserBooking","match","params","id","then","res","data","getCar","getLocationFromId","getGeocodeFromAddress","address","newRes","locationObject","_id","name","lat","results","geometry","lng","cars","catch","error","response","message","componentDidMount","status","modifyBooking","pickupTime","currentTime","Date","setMinutes","getMinutes","getTimezoneOffset","render","height","google","width","onInfoWindowClose","bookedtime","pickuptime","returntime","cost","image","marginTop","make","fueltype","bodytype","seats","colour","numberplate","apiKey","process","env","REACT_APP_API_KEY"],"mappings":"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","sourcesContent":["/* Bookings details page */\r\nimport React, { Component } from 'react';\r\nimport { Map, InfoWindow, Marker, GoogleApiWrapper } from 'google-maps-react';\r\nimport { Alert, Button, Col } from 'react-bootstrap';\r\nimport BookingServiceApi from '../../api/BookingServiceApi';\r\nimport CarServiceApi from '../../api/CarServiceApi';\r\nimport LocationServiceApi from '../../api/LocationServiceApi';\r\n\r\nclass BookingDetailsPage extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            location: {},\r\n            booking: {},\r\n            driver: {},\r\n            car: {},\r\n            errorMessage: '',\r\n            activeMarker: {},\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            isLoading: false\r\n        };\r\n        this.handleCancelButton = this.handleCancelButton.bind(this);\r\n        this.getBookingDetails = this.getBookingDetails.bind(this);\r\n        this.checkBookingPast = this.checkBookingPast.bind(this);\r\n    }\r\n\r\n    getBookingDetails() {\r\n        // obtain a user's booking by booking id and also car and location associated\r\n        BookingServiceApi.getUserBooking(this.props.match.params.id)\r\n            .then(res => {\r\n                this.setState({\r\n                    booking: res.data.booking\r\n                });\r\n                CarServiceApi.getCar(this.state.booking.car)\r\n                    .then(res => {\r\n                        this.setState({\r\n                            car: res.data.car\r\n                        })\r\n                    });\r\n                LocationServiceApi.getLocationFromId(this.state.booking.location)\r\n                    .then(res => {\r\n                        LocationServiceApi.getGeocodeFromAddress(res.data.address)\r\n                            .then(newRes => {\r\n                                // Create object with address, latitude and longitude\r\n                                let locationObject = {\r\n                                    id: res.data._id,\r\n                                    address: res.data.address,\r\n                                    name: res.data.name,\r\n                                    lat: newRes.data.results[0].geometry.location.lat,\r\n                                    lng: newRes.data.results[0].geometry.location.lng,\r\n                                    cars: res.data.cars\r\n                                };\r\n                                // set new location object to react state array\r\n                                this.setState({\r\n                                    location: locationObject,\r\n                                    isLoading: true\r\n                                });\r\n                            });\r\n                    });\r\n            }).catch((error) => {\r\n                this.setState({ errorMessage: error.response.data.message });\r\n            })\r\n    }\r\n\r\n    mapOnMarkerClick = (props, marker) =>\r\n        this.setState({\r\n            selectedPlace: props,\r\n            activeMarker: marker,\r\n            showingInfoWindow: true,\r\n        });\r\n\r\n    mapOnMapClick = () =>\r\n        this.setState({\r\n            showingInfoWindow: false,\r\n            selectedPlace: {},\r\n            activeMarker: {}\r\n        });\r\n\r\n    componentDidMount() {\r\n        this.getBookingDetails();\r\n    }\r\n\r\n    handleCancelButton() {\r\n        // modify booking status to cancelled\r\n        let booking = this.state.booking;\r\n        booking.status = 'Cancelled';\r\n        booking.id = booking._id;\r\n        this.setState({\r\n            booking: booking\r\n        });\r\n        BookingServiceApi.modifyBooking(this.state.booking)\r\n            .then(() => {\r\n                this.getBookingDetails()\r\n            }).catch((error) => {\r\n                this.setState({ errorMessage: error.response.data.message });\r\n            });\r\n    }\r\n\r\n    checkBookingPast(pickupTime) {\r\n        // check if booking pickup time has past current time\r\n        let currentTime = new Date();\r\n        currentTime.setMinutes(currentTime.getMinutes() - currentTime.getTimezoneOffset());\r\n        return new Date(pickupTime) > currentTime;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"container\">\r\n                <h2>Booking details</h2>\r\n                {this.state.errorMessage && <Alert variant=\"danger\">\r\n                    <Alert.Heading>Error obtaining booking!</Alert.Heading>\r\n                    <p>\r\n                        {this.state.errorMessage}\r\n                    </p>\r\n                </Alert>}\r\n                {!this.state.errorMessage &&\r\n                    <>\r\n                        {this.state.isLoading && <div id=\"garage-map\" style={{ height: '400px' }}>\r\n                            <Map google={this.props.google}\r\n                                initialCenter={{\r\n                                    lat: this.state.location.lat,\r\n                                    lng: this.state.location.lng\r\n                                }}\r\n                                style={{ height: '400px', width: '400px' }}\r\n                                zoom={14}\r\n                                onClick={this.mapOnMapClick}>\r\n\r\n                                <Marker\r\n                                    id={this.state.location.id}\r\n                                    name={this.state.location.name}\r\n                                    address={this.state.location.address}\r\n                                    onClick={this.mapOnMarkerClick}\r\n                                    position={{ lat: this.state.location.lat, lng: this.state.location.lng }}\r\n                                />\r\n\r\n                                <InfoWindow\r\n                                    onClose={this.onInfoWindowClose}\r\n                                    marker={this.state.activeMarker}\r\n                                    visible={this.state.showingInfoWindow}>\r\n                                    <div id=\"info-window\">\r\n                                        <h2>{this.state.selectedPlace.name}</h2>\r\n                                        <p>{this.state.selectedPlace.address}</p>\r\n                                        <a href={\"/locations/\" + this.state.selectedPlace.id}>Check out this location</a>\r\n                                    </div>\r\n                                </InfoWindow>\r\n                            </Map>\r\n                        </div>}\r\n                        <b>Booking ID: </b> {this.state.booking._id} <br></br>\r\n                        <b>Booking time: </b> {this.state.booking.bookedtime} <br></br>\r\n                        <b>Pickup time: </b> {this.state.booking.pickuptime} <br></br>\r\n                        <b>Return time: </b> {this.state.booking.returntime} <br></br>\r\n                        <b>Cost: </b> Php{this.state.booking.cost} <br></br>\r\n                        <b>Location: </b> {this.state.location.name} <br></br>\r\n                        <b>Address: </b> {this.state.location.address} <br></br>\r\n                        <b>Status: </b> {this.state.booking.status} <br></br>\r\n                        {(this.state.booking.status === \"Confirmed\" && this.checkBookingPast(this.state.booking.pickuptime)) &&\r\n                            <Button variant=\"danger\" onClick={this.handleCancelButton}>Cancel</Button>\r\n                        }\r\n                        <Col sm={4}>\r\n                            <div className=\"cars-div-white\" style={{ 'border': 'solid black 2px' }}>\r\n                                <img src={this.state.car.image} alt=\"car\" width=\"100\" />\r\n                                <h2 style={{ marginTop: '1vh' }}>{this.state.car.make}</h2>\r\n                                <h3 style={{ marginTop: '1vh' }}>{this.state.car.driver}</h3>\r\n                                <p>{this.state.car.fueltype}, {this.state.car.bodytype}, {this.state.car.seats} seaters, {this.state.car.colour}</p>\r\n                                <h5>Number Plate: {this.state.car.numberplate}</h5>\r\n                                <p><b>Car ID: </b>{this.state.car._id}</p>\r\n                            </div>\r\n                        </Col>\r\n                    </>\r\n                }\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default GoogleApiWrapper({\r\n    apiKey: process.env.REACT_APP_API_KEY\r\n})(BookingDetailsPage);\r\n"]},"metadata":{},"sourceType":"module"}